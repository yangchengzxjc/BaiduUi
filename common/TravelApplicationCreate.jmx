<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.1.1 r1855137">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="测试计划" enabled="true">
      <stringProp name="TestPlan.comments"></stringProp>
      <boolProp name="TestPlan.functional_mode">false</boolProp>
      <boolProp name="TestPlan.tearDown_on_shutdown">true</boolProp>
      <boolProp name="TestPlan.serialize_threadgroups">false</boolProp>
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments" guiclass="ArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
        <collectionProp name="Arguments.arguments"/>
      </elementProp>
      <stringProp name="TestPlan.user_define_classpath"></stringProp>
    </TestPlan>
    <hashTree>
      <ConfigTestElement guiclass="HttpDefaultsGui" testclass="ConfigTestElement" testname="HTTP请求默认值" enabled="true">
        <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
          <collectionProp name="Arguments.arguments"/>
        </elementProp>
        <stringProp name="HTTPSampler.domain">${serverUrl}</stringProp>
        <stringProp name="HTTPSampler.port"></stringProp>
        <stringProp name="HTTPSampler.protocol">${protocol}</stringProp>
        <stringProp name="HTTPSampler.contentEncoding"></stringProp>
        <stringProp name="HTTPSampler.path"></stringProp>
        <stringProp name="HTTPSampler.concurrentPool">6</stringProp>
        <stringProp name="HTTPSampler.connect_timeout">1500000</stringProp>
        <stringProp name="HTTPSampler.response_timeout">1500000</stringProp>
      </ConfigTestElement>
      <hashTree/>
      <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP信息头管理器" enabled="true">
        <collectionProp name="HeaderManager.headers">
          <elementProp name="" elementType="Header">
            <stringProp name="Header.name">Content-Type</stringProp>
            <stringProp name="Header.value">application/json</stringProp>
          </elementProp>
          <elementProp name="" elementType="Header">
            <stringProp name="Header.name">Authorization</stringProp>
            <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
          </elementProp>
        </collectionProp>
      </HeaderManager>
      <hashTree/>
      <TestFragmentController guiclass="TestFragmentControllerGui" testclass="TestFragmentController" testname="差旅申请单创建" enabled="true"/>
      <hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="保存差旅申请单_未添加行程" enabled="true">
          <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
            <collectionProp name="Arguments.arguments">
              <elementProp name="" elementType="HTTPArgument">
                <boolProp name="HTTPArgument.always_encode">false</boolProp>
                <stringProp name="Argument.value">{&#xd;
	&quot;formOID&quot;: &quot;${apFormOID}&quot;,&#xd;
	&quot;id&quot;: &quot;${apFormId}&quot;,&#xd;
	&quot;formName&quot;: &quot;${apFormName}&quot;,&#xd;
	&quot;iconName&quot;: &quot;&quot;,&#xd;
	&quot;iconUrl&quot;: null,&#xd;
	&quot;messageKey&quot;: null,&#xd;
	&quot;formType&quot;: ${apFormType},&#xd;
	&quot;asSystem&quot;: false,&#xd;
	&quot;valid&quot;: true,&#xd;
	&quot;createdDate&quot;: &quot;${NewUTCstartDate}&quot;,&#xd;
	&quot;lastModifiedDate&quot;: &quot;${NewUTCstartDate}&quot;,&#xd;
	&quot;parentOID&quot;: null,&#xd;
	&quot;associateExpenseReport&quot;: true,&#xd;
	&quot;customFormFields&quot;: ${customFormFields},&#xd;
	&quot;remark&quot;: &quot;&quot;,&#xd;
	&quot;sequence&quot;: 90,&#xd;
	&quot;referenceOID&quot;: &quot;${referenceOID}&quot;,&#xd;
	&quot;groupOIDs&quot;: [],&#xd;
	&quot;visibleExpenseTypeScope&quot;: 1001,&#xd;
	&quot;visibleLoanTypeScope&quot;: null,&#xd;
	&quot;expenseTypeOIDs&quot;: [],&#xd;
	&quot;expenseReport&quot;: null,&#xd;
	&quot;formCode&quot;: null,&#xd;
	&quot;companyOID&quot;: &quot;${companyOID}&quot;,&#xd;
	&quot;companyId&quot;: ${companyId},&#xd;
	&quot;travelManageType&quot;: null,&#xd;
	&quot;controlFields&quot;: null,&#xd;
	&quot;customFormProperties&quot;: ${customFormProperties},&#xd;
	&quot;customFormPropertyMap&quot;: ${customFormPropertyMap},&#xd;
	&quot;expenseTypeCheckStatus&quot;: null,&#xd;
	&quot;proxyForm&quot;: false,&#xd;
	&quot;i18n&quot;: null,&#xd;
	&quot;tenantId&quot;: &quot;${tenantId}&quot;,&#xd;
	&quot;booksID&quot;: null,&#xd;
	&quot;setOfBooksId&quot;: &quot;${setOfBooksId}&quot;,&#xd;
	&quot;fromType&quot;: 1,&#xd;
	&quot;visibleCompanyScope&quot;: 1,&#xd;
	&quot;companyOIDList&quot;: null,&#xd;
	&quot;companyList&quot;: null,&#xd;
	&quot;companyName&quot;: null,&#xd;
	&quot;budgetEnabled&quot;: false,&#xd;
	&quot;visibleUserScope&quot;: 1001,&#xd;
	&quot;submit&quot;: false,&#xd;
	&quot;custFormValues&quot;: ${NewcustFormValues},&#xd;
	&quot;referenceApplicationOID&quot;: &quot;&quot;,&#xd;
	&quot;applicantOID&quot;: &quot;${userOID}&quot;,&#xd;
	&quot;travelApplication&quot;: {&#xd;
		&quot;manageType&quot;: &quot;1002&quot;,&#xd;
		&quot;travelItinerarys&quot;: [{&#xd;
			&quot;itineraryDate&quot;: &quot;${NewUTCstartDate}&quot;,&#xd;
			&quot;travelElements&quot;: [],&#xd;
			&quot;travelItineraryTraffics&quot;: []&#xd;
		}],&#xd;
		&quot;totalBudget&quot;: ${apamount}&#xd;
	}&#xd;
}</stringProp>
                <stringProp name="Argument.metadata">=</stringProp>
              </elementProp>
            </collectionProp>
          </elementProp>
          <stringProp name="HTTPSampler.domain"></stringProp>
          <stringProp name="HTTPSampler.port"></stringProp>
          <stringProp name="HTTPSampler.protocol"></stringProp>
          <stringProp name="HTTPSampler.contentEncoding"></stringProp>
          <stringProp name="HTTPSampler.path">api/travel/applications/draft</stringProp>
          <stringProp name="HTTPSampler.method">POST</stringProp>
          <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
          <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
          <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
          <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
          <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
          <stringProp name="HTTPSampler.connect_timeout"></stringProp>
          <stringProp name="HTTPSampler.response_timeout"></stringProp>
        </HTTPSamplerProxy>
        <hashTree>
          <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP信息头管理器" enabled="true">
            <collectionProp name="HeaderManager.headers">
              <elementProp name="" elementType="Header">
                <stringProp name="Header.name">Content-Type</stringProp>
                <stringProp name="Header.value">application/json</stringProp>
              </elementProp>
              <elementProp name="" elementType="Header">
                <stringProp name="Header.name">Authorization</stringProp>
                <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
              </elementProp>
            </collectionProp>
          </HeaderManager>
          <hashTree/>
          <ResponseAssertion guiclass="AssertionGui" testclass="ResponseAssertion" testname="响应断言" enabled="true">
            <collectionProp name="Asserion.test_strings">
              <stringProp name="49587">201</stringProp>
            </collectionProp>
            <stringProp name="Assertion.test_field">Assertion.response_code</stringProp>
            <boolProp name="Assertion.assume_success">false</boolProp>
            <intProp name="Assertion.test_type">8</intProp>
            <stringProp name="Assertion.custom_message"></stringProp>
          </ResponseAssertion>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="获取applicantOID" enabled="false">
            <stringProp name="JSONPostProcessor.referenceNames">applicationOID1;applicantName;applicationParticipant;applicationParticipants;businessCode1;companyOID;corporationOID;costCenterItemOID;createdBy;custFormValues;customFormProperties;departmentName</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$.applicationOID;$.applicantName;$.applicationParticipant;$.applicationParticipants;$.businessCode;$.companyOID;$.corporationOID;$.costCenterItemOID;$.createdBy;$.custFormValues;customFormProperties;$.departmentName</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers"></stringProp>
            <stringProp name="JSONPostProcessor.defaultValues">null;null;null;null;null;null;null;null;null;null;null;null</stringProp>
          </JSONPostProcessor>
          <hashTree/>
          <BeanShellPreProcessor guiclass="TestBeanGUI" testclass="BeanShellPreProcessor" testname="处理custFormValues" enabled="true">
            <boolProp name="resetInterpreter">false</boolProp>
            <stringProp name="parameters"></stringProp>
            <stringProp name="filename"></stringProp>
            <stringProp name="script">import com.google.gson.Gson;
import com.google.gson.JsonArray;
import com.google.gson.JsonParser;
import com.google.gson.JsonObject;

String json = vars.get(&quot;customFormFields&quot;);
log.info(&quot;customFormFields===========&quot;+json);
JsonArray MYjsonArray=new JsonParser().parse(json).getAsJsonArray();
log.info(&quot;MYjsonArray==:&quot;+MYjsonArray.toString());
int size = MYjsonArray.size();
for (int i = 0; i &lt; size; i++){
            JsonObject jsonObject =MYjsonArray.get(i).getAsJsonObject();
            log.info(jsonObject.get(&quot;fieldName&quot;).getAsString());
            
             if (jsonObject.get(&quot;fieldName&quot;).getAsString().equals(&quot;部门&quot;))
           		jsonObject.addProperty(&quot;value&quot;,vars.get(&quot;departmentOID&quot;));
             if (jsonObject.get(&quot;fieldName&quot;).getAsString().equals(&quot;开始日期&quot;)){
           		jsonObject.addProperty(&quot;value&quot;,vars.get(&quot;startDate&quot;));
           		jsonObject.addProperty(&quot;endDate&quot;,vars.get(&quot;startDate&quot;));
             }
             if (jsonObject.get(&quot;fieldName&quot;).getAsString().equals(&quot;结束日期&quot;)){
           		jsonObject.addProperty(&quot;value&quot;,vars.get(&quot;startDate&quot;));
           		jsonObject.addProperty(&quot;endDate&quot;,vars.get(&quot;startDate&quot;));
             }
             if (jsonObject.get(&quot;fieldName&quot;).getAsString().equals(&quot;事由&quot;))
           		jsonObject.addProperty(&quot;value&quot;,&quot;超申请报销单费用类型管控发&quot;);
             if (jsonObject.get(&quot;fieldName&quot;).getAsString().equals(&quot;参与人员&quot;))
             {
			String vv=vars.get(&quot;participant&quot;);
             	jsonObject.addProperty(&quot;value&quot;,vv);
             }

             if (jsonObject.get(&quot;fieldName&quot;).getAsString().equals(&quot;预算明细&quot;))
             {
			String vv=vars.get(&quot;Budget&quot;);
             	jsonObject.addProperty(&quot;value&quot;,vv);
             }
}
String str =MYjsonArray.toString();
log.info(&quot;NewcustFormValues==:&quot;+MYjsonArray.toString());
vars.put(&quot;NewcustFormValues&quot;,str);

</stringProp>
          </BeanShellPreProcessor>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="获取保存的响应" enabled="false">
            <stringProp name="JSONPostProcessor.referenceNames">Save_response</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers"></stringProp>
          </JSONPostProcessor>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="applicantOID;applicationOID;applicationParticipant;applicationParticipants" enabled="true">
            <stringProp name="JSONPostProcessor.referenceNames">applicantOID;applicationOID;applicationParticipant;applicationParticipants</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$.applicantOID;$.applicationOID;$.applicationParticipant;$.applicationParticipants</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers"></stringProp>
            <stringProp name="JSONPostProcessor.defaultValues">Not found;Not found;Not found;Not found</stringProp>
          </JSONPostProcessor>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="custFormValues;customFormProperties;companyOID;corporationOID" enabled="false">
            <stringProp name="JSONPostProcessor.referenceNames">custFormValues;customFormProperties;companyOID;corporationOID</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$.custFormValues;$.customFormProperties;$.companyOID;$.corporationOID;</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers"></stringProp>
            <stringProp name="JSONPostProcessor.defaultValues">Not found;Not found;Not found;Not found</stringProp>
          </JSONPostProcessor>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="formOID;businessCode;travelApplication;departmentOID;subCompanyOID" enabled="false">
            <stringProp name="JSONPostProcessor.referenceNames">formOID;businessCode;travelApplication;departmentOID;subCompanyOID</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$.custFormValues[0].formOID;$.businessCode;$.travelApplication;$.applicant.departmentOID;$.subCompanyOID</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers"></stringProp>
            <stringProp name="JSONPostProcessor.defaultValues">Not found;Not found;Not found;Not found;Not found</stringProp>
          </JSONPostProcessor>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="JSON Extractor" enabled="true">
            <stringProp name="JSONPostProcessor.referenceNames">data</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers"></stringProp>
          </JSONPostProcessor>
          <hashTree/>
        </hashTree>
      </hashTree>
    </hashTree>
  </hashTree>
</jmeterTestPlan>
